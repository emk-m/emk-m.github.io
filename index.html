<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>p5 Media-First Video Editor</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.4.0/p5.js"></script>
  <style>
    html, body {
      margin: 0;
      padding: 0;
      background: #111;
      color: #fafafa;
      height: 100%;
      overflow: hidden;
      font-family: sans-serif;
    }
    #defaultCanvas0 {
      display: block;
      margin: 0 auto;
      background: #000;
    }
    .ui {
      position: absolute;
      top: 20px;
      left: 20px;
      z-index: 10;
      display: flex;
      align-items: center;
      gap: 20px;
      color: #fafafa;
    }
    .ui input[type=file] {
      font-size: 14px;
      cursor: pointer;
      background: rgba(255,255,255,0.1);
      border: 1px solid rgba(255,255,255,0.3);
      color: #fafafa;
    }
    .ui .filename {
      max-width: 300px;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
      font-size: 14px;
    }
    .ui .slider-container {
      display: flex;
      flex-direction: column;
      align-items: flex-start;
      font-size: 14px;
    }
    .ui input[type=range] {
      -webkit-appearance: none;
      width: 180px;
      height: 6px;
      background: rgba(255,255,255,0.2);
      margin-top: 4px;
    }
    .ui input[type=range]::-webkit-slider-thumb {
      -webkit-appearance: none;
      width: 12px;
      height: 12px;
      background: #fafafa;
      cursor: pointer;
      border-radius: 0;
      border: none;
    }
  </style>
</head>
<body>
<script>
let video;
let playing = false;
let speedSlider;
let uploadInput;
let fileName = "";

function setup() {
  // Make the canvas fill the window (minus minimal margins)
  createCanvas(windowWidth, windowHeight);
  background(0);

  // UI container
  const ui = createDiv().addClass('ui');

  // Upload label + input
  const fileLabel = createSpan('Upload Video:');
  fileLabel.parent(ui);
  uploadInput = createFileInput(handleFile);
  uploadInput.attribute('accept', 'video/*');
  uploadInput.parent(ui);

  // Filename display
  const nameEl = createSpan('').addClass('filename');
  nameEl.parent(ui);

  // Speed slider in a small container
  const sliderCont = createDiv().addClass('slider-container');
  sliderCont.parent(ui);
  createSpan('Playback Speed').parent(sliderCont);
  speedSlider = createSlider(0.25, 2, 1, 0.01);
  speedSlider.parent(sliderCont);
}

function windowResized() {
  resizeCanvas(windowWidth, windowHeight);
}

function handleFile(file) {
  if (file.type === 'video') {
    fileName = file.name;
    select('.filename').html(fileName);

    if (video) {
      video.remove();
    }
    video = createVideo(file.data, () => {
      video.loop();
      video.volume(0);
      video.hide();
      playing = true;
    });
  } else {
    console.log("Please upload a valid video file");
  }
}

function draw() {
  background(0);
  if (playing && video) {
    video.speed(speedSlider.value());

    // Maintain aspect ratio
    let vw = video.width;
    let vh = video.height;
    let wratio = width / vw;
    let hratio = height / vh;
    let scale = min(wratio, hratio);
    let dw = vw * scale;
    let dh = vh * scale;
    let dx = (width - dw) / 2;
    let dy = (height - dh) / 2;

    // Draw base
    tint(255, 127);
    image(video, dx, dy, dw, dh);

    // Inverted copy
    video.loadPixels();
    if (video.pixels.length > 0) {
      let inverted = createImage(vw, vh);
      inverted.loadPixels();
      for (let i = 0; i < video.pixels.length; i += 4) {
        inverted.pixels[i]     = 255 - video.pixels[i];
        inverted.pixels[i + 1] = 255 - video.pixels[i + 1];
        inverted.pixels[i + 2] = 255 - video.pixels[i + 2];
        inverted.pixels[i + 3] = video.pixels[i + 3];
      }
      inverted.updatePixels();

      tint(255, 127);
      image(inverted, dx, dy, dw, dh);
    }
  }
}
</script>
</body>
</html>

    </script>
</body>
</html>
